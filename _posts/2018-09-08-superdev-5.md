---
title: "Super Dev 5"
header:
  overlay_image: /assets/images/unsplash-image-1.jpg
  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
  cta_url: "https://unsplash.com"
date: 2018-09-08 11:02:40 -0400
categories: super developer
---

<ol start="5">
  <li> C또는 C++에서 메모리 관련 버그에는 어떤 것이 있는가? 각각 디버깅은 어떻게 할 수 있는가? 자바 또는 다른 어떤 언어에서의 가비지 컬렉터의 역할은 무엇이고 그 원리는 무엇인가?
</li>
</ol>

- C 또는 C++에서 메모리 관련 버그에는 어떤 것이 있는가? 

메모리 관련하여 메모리 초과되는 경우 자바의 OutOfMemoryError 등과 같이 확실한 에러가 일어나는 경우가 있고, 개발자나 사용자가 초기에는 잘 알 수 없는 메모리 누수 등의 문제가 있다.

메모리 누수는 힙 영역에 새로 만든 메모리 영역을 적당히 해제하지 않아서 생기는 현상이다. C와 C++은 가비지 컬렉터를 지원하지 않기 때문에, malloc()등으로 생성한 메모리를 꼭 해제 해줘야 한다. 이러한 상황하에서 해제 해주지 않는 경우 사용하지 않더라도 메모리는 그대로 점유한다.

- 메모리 누수 디버깅 방법

#include <crtdbg.h> 추가하고, main에 

_CrtSetDbgFlag(_CRTDBG_ALLOC_MEM_DF|_CRTDBG_LEAK_CHECK_DF);

로 메모리 누수를 확인한다. 

이 함수로 인해 메모리 할당 번호가 나오면 그 번호를

_CrtSetBreakAlloc(번호);

에 넣으면 alert 이후에 메모리가 누수 된 지점 혹은 근처에서 브레이크를 시켜준다.


- 가비지 컬렉터의 역할

더 이상 사용하지 않는 메모리를 특정 알고리즘에 의해 판단하여 자동으로 회수한다.

- 가비지 컬렉터의 원리

가비지 컬렉터에는 표시하고 지우는 방법과 참조 카운팅 있는데, 이는 잘 정리된 블로그를 인용하는 것으로 대체하겠다.(https://feel5ny.github.io/2017/11/30/JS_02/)


> 표시하고 지우기 Mark and Sweep

가장 널리 쓰이는 컬렉션 방법이다.

변수가 특정 컨텍스트 안에서 사용할 것으로 정의되면 그 변수는 그 컨텍스트 안에 있는 것으로 표시된다. 표시한는 구체적인 방법은 알 필요는 없다..

GC가 작동하면

	1	메모리에 저장된 변수 전체를 표시한다.
	2	컨텍스트에 있는 변수, 컨텍스트에 있는 변수가 참조하는 변수의 표시를 지운다.
	3	표시가 지워지지 않는 변수를 삭제한다.
가비지 컬렉터는 ‘메모리 청소’를 실행해 표시가 남아 있는 값을 모두 파괴하고 메모리를 회수한다.


> 참조 카운팅 Reference counting

각 값이 얼마나 많이 참조 되었는지 추적한다.

	1	변수를 선언하고 참조 값이 할당되면 참조 카운트는 1이다.
	2	다른 변수가 같은 값을 참조하면 참조 카운트가 늘어난다.
	3	마찬가지로 해당 값을 참조하는 변수에 다른 값을 할당하면 원래 값의 참조 카운트가 줄어든다.
	4	값의 참조 카운트가 0이 되면 해당 값에 접근할 방법이 없으며, 메모리를 회수해도 안전하다.
	5	다음 가비지 컬렉터를 실행할 때 참조 카운트가 0인 값에서 사용하던 메모리를 회수한다.

순환 참조 문제
이 알고리즘은 두 object가 서로를 참조하면 문제가 발생한다.

위의 코드를 보면 새로운 객체가 생성되면서 참조 카운트가 1이되고,
서로 참조하게 되면서 참조카운트가 2가 된다.

이 상태에서 스코프를 벗어나게 되면, 해당 변수는 사용되지 않는데, 벗어났음에도 카운트가 0이 아니기 때문에 GC가 컬렉션을 하지 않게 된다. 이는 곧 메모리 낭비로 이어진다.

이때는 강제로 null을 항당해서 참조했던 값으로의 연결을 끊어줘야한다.
